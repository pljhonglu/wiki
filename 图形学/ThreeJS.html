<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <title>ThreeJS - 独 奏's Wiki</title>
        <meta name="keywords" content="Wiki, 独奏, 鸿禄"/>
        <meta name="description" content="独奏的个人 Wiki，独奏的 Blog 地址：http://homglu.me。"/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
    <div id="header">
        <div id="post-nav">
            
            <a href="/">Home</a> » <a href="/#图形学">图形学</a> » ThreeJS
            
        </div>
    </div>
    <div class="clearfix"></div>
    <div id="title">ThreeJS</div>
    <div id="content">
        <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">开始</a></li>
<li><a href="#_2">世界坐标转换屏幕坐标系</a></li>
<li><a href="#mvp">MVP 矩阵</a></li>
</ul>
</div>
<h2 id="_1">开始</h2>
<div class="hlcode"><pre><span class="c1">// 入口</span>
<span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">initThree</span><span class="p">();</span>
  <span class="nx">initCamera</span><span class="p">();</span>
  <span class="nx">initScene</span><span class="p">();</span>
  <span class="nx">initObject</span><span class="p">();</span>
  <span class="nx">render</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// 初始化容器</span>
<span class="kd">var</span> <span class="nx">renderer</span><span class="p">,</span><span class="nx">container</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">initThree</span><span class="p">(){</span>
  <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span> <span class="s1">&#39;canvas&#39;</span> <span class="p">);</span>

  <span class="nx">width</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">;</span>
  <span class="nx">height</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
  <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderer</span><span class="p">();</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nx">setPixelRatio</span><span class="p">(</span> <span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span> <span class="p">);</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span> <span class="p">);</span>

  <span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">domElement</span> <span class="p">);</span>
<span class="p">}</span>
<span class="c1">// 初始化相机</span>
<span class="kd">var</span> <span class="nx">camera</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">initCamera</span><span class="p">(){</span>
  <span class="nx">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1100</span> <span class="p">);</span>
  <span class="nx">camera</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="p">}</span>
<span class="c1">// 初始化场景</span>
<span class="kd">var</span> <span class="nx">scene</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">initScene</span><span class="p">(){</span>
  <span class="nx">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Scene</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// 加入组件</span>
<span class="kd">function</span> <span class="nx">initObject</span><span class="p">(){</span>
    <span class="c1">// 圆球</span>
  <span class="kd">var</span> <span class="nx">geometry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">SphereGeometry</span><span class="p">(</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">40</span> <span class="p">);</span>
  <span class="nx">geometry</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
    <span class="c1">//纹理</span>
  <span class="kd">var</span> <span class="nx">material</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">(</span> <span class="p">{</span>
      <span class="nx">map</span><span class="o">:</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">TextureLoader</span><span class="p">().</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;image_0.jpg&#39;</span><span class="p">)</span>
  <span class="p">}</span> <span class="p">);</span>
    <span class="c1">// 网格</span>
  <span class="kd">var</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span> <span class="nx">geometry</span><span class="p">,</span> <span class="nx">material</span> <span class="p">);</span>
  <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="nx">mesh</span> <span class="p">);</span>
  <span class="c1">// 矩形</span>
  <span class="nx">ar</span> <span class="nx">plane</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PlaneGeometry</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">planeMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span>
      <span class="nx">color</span><span class="o">:</span> <span class="mh">0xffff00</span><span class="p">,</span>
      <span class="c1">// wireframe: true</span>
  <span class="p">});</span>
  <span class="kd">var</span> <span class="nx">planeMesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">plane</span><span class="p">,</span> <span class="nx">planeMaterial</span><span class="p">);</span>
  <span class="nx">planeMesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">480</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="nx">planeMesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">2</span>
  <span class="nx">planeMesh</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;plane&quot;</span>
  <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">planeMesh</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 渲染</span>
<span class="kd">function</span> <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">requestAnimationFrame</span><span class="p">(</span> <span class="nx">render</span> <span class="p">);</span>
  <span class="nx">update</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// 更新视图</span>
<span class="kd">function</span> <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// do something...</span>

  <span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span> <span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>


<h2 id="_2">世界坐标转换屏幕坐标系</h2>
<div class="hlcode"><pre><span class="n">var</span> <span class="n">world_vector</span> <span class="o">=</span> <span class="n">new</span> <span class="n">THREE</span><span class="p">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">var</span> <span class="n">vector</span> <span class="o">=</span> <span class="n">world_vector</span><span class="p">.</span><span class="n">project</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
<span class="c1">// console.log(vector);</span>
<span class="n">var</span> <span class="n">halfWidth</span> <span class="o">=</span> <span class="n">container</span><span class="p">.</span><span class="n">clientWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">var</span> <span class="n">halfHeight</span> <span class="o">=</span> <span class="n">container</span><span class="p">.</span><span class="n">clientHeight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

<span class="n">var</span> <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
 <span class="nl">x:</span> <span class="n">Math</span><span class="p">.</span><span class="n">round</span><span class="p">(</span><span class="n">vector</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">halfWidth</span> <span class="o">+</span> <span class="n">halfWidth</span><span class="p">),</span>
 <span class="nl">y:</span> <span class="n">Math</span><span class="p">.</span><span class="n">round</span><span class="p">(</span><span class="o">-</span><span class="n">vector</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">halfHeight</span> <span class="o">+</span> <span class="n">halfHeight</span><span class="p">)</span>
<span class="p">};</span>
</pre></div>


<p>转换后 vector 中 z 的值在 0-1 之间表示该坐标在相机视野内，其他值标识超出相机视野。</p>
<h2 id="mvp">MVP 矩阵</h2>
<ul>
<li>M(model) : 世界矩阵 </li>
<li>V(view) : 摄像机矩阵 </li>
<li>P(project) : 投影矩阵 </li>
<li>T(transpose) : 矩阵的转置 </li>
<li>IT(inverse transpose) : 转置的逆矩阵 </li>
</ul>
    </div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2016 <a href="http://honglu.me" target="_blank">独 奏</a>.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>